# 网站嵌入

> 学习来源：https://docs.dify.ai/en/use-dify/publish/webapp/embedding-in-websites

## 一、概述

你发布的 Web 应用可以直接嵌入到任何网站中。这不是一个单独的发布方法——它是你部署已创建的相同 Web 应用的方式，只是在你现有的网站中呈现，而不是作为独立页面。

## 二、Web App 嵌入的工作原理

当你发布 Dify 中的应用时，你会获得一个 Web 应用 URL。你可以直接分享这个 URL，或者使用以下方法将相同的应用嵌入到你的网站中：

### 2.1 嵌入方式

1. **Chat Bubble Widget（聊天气泡组件）**：你的 Web 应用作为浮动按钮——访问者点击打开完整界面
2. **Iframe Integration（Iframe 集成）**：你的 Web 应用直接嵌入在页面内容中——始终可见并准备就绪
3. **JavaScript Control（JavaScript 控制）**：高级嵌入，具有自定义样式和行为控制
4. **Responsive Design（响应式设计）**：相同的 Web 应用自动适应任何呈现格式

**信息提示**：所有嵌入方法都使用你发布的 Web 应用。对你的应用配置的更改会自动应用到它嵌入的所有位置。

## 三、Chat Bubble Widget（聊天气泡组件）

聊天气泡将你的 Web 应用呈现为浮动按钮。访问者点击它以在覆盖层中打开你的应用——让他们停留在你的页面上，同时访问你的 AI 功能。

### 3.1 配置选项

聊天气泡可以通过 `difyChatbotConfig` 对象进行自定义：

```javascript
window.difyChatbotConfig = {
  // Required: Your app's token from Dify
  token: 'YOUR_TOKEN',
  
  // Optional: Environment settings
  isDev: false,
  baseUrl: 'https://udify.app', // Auto-set based on isDev
  
  // Optional: Visual customization
  containerProps: {
    style: {
      right: '20px',
      bottom: '20px'
    },
    className: 'custom-chat-button'
  },
  
  // Optional: Interactive behavior
  draggable: false, // Allow users to drag the button
  dragAxis: 'both', // 'x', 'y', or 'both'
  
  // Optional: Pre-fill user context
  inputs: {
    name: "John Doe", // Variable names from your Dify app
    department: "Support"
  },
  
  // Optional: System variables for tracking
  systemVariables: {
    user_id: 'USER_123',
    conversation_id: 'CONV_456'
  },
  
  // Optional: User profile information
  userVariables: {
    avatar_url: 'https://example.com/avatar.jpg',
    name: 'John Doe'
  }
}
```

### 3.2 设置步骤

1. **获取你的嵌入令牌**：在你的 Dify 应用中，转到 **Publish → Embed** 以找到你的唯一令牌
2. **添加脚本**：在你的网站 HTML 中包含配置和 Dify 的嵌入脚本
3. **自定义外观**：调整 `containerProps` 以匹配你网站的设计
4. **测试功能**：打开你的网站并尝试聊天按钮以确保一切正常工作

## 四、Iframe Integration（Iframe 集成）

将你的 Web 应用直接嵌入到页面内容中。这会将你的应用显示为你网站的组成部分。

### 4.1 基本用法

```html
<iframe
  src="https://udify.app/chatbot/YOUR_APP_TOKEN"
  width="100%"
  height="600"
  frameborder="0">
</iframe>
```

### 4.2 为什么使用 Iframe 嵌入

- **始终可见**：你的 Web 应用立即可访问，不隐藏在按钮后面
- **完整功能**：来自你的 Web 应用的所有内容在 iframe 中完全相同地工作
- **页面集成**：显示为原生内容，而不是覆盖层
- **简单设置**：只需 HTML，无需 JavaScript 配置

### 4.3 自定义选项

**大小和位置**：
```html
<iframe
  src="https://udify.app/chatbot/YOUR_APP_TOKEN"
  width="400px"
  height="500px"
  style="border: 1px solid #ccc; border-radius: 8px;">
</iframe>
```

**响应式设计**：
```html
<div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;">
  <iframe
    src="https://udify.app/chatbot/YOUR_APP_TOKEN"
    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
    frameborder="0">
  </iframe>
</div>
```

## 五、选择你的嵌入方法

根据你的使用场景选择合适的方法：

- **Customer Support Apps（客户支持应用）**：Chat Bubble Widget
- **Form & Workflow Apps（表单和工作流应用）**：Iframe Integration
- **Product Demonstrations（产品演示）**：Iframe Integration
- **Multi-page Integration（多页面集成）**：JavaScript Control

## 六、故障排除

### 6.1 Widget 不显示

- 验证你的应用令牌是否与 Dify 的 Publish → Embed 部分显示的匹配
- 检查配置是否在嵌入脚本之前加载
- 在浏览器控制台中查找 JavaScript 错误

### 6.2 Iframe 不加载

- 确认 Web 应用 URL 包含你的正确令牌
- 确保你的网站允许 iframe 内容（检查内容安全策略）
- 你的网站和 Dify 应用都应使用 HTTPS

**警告**：你的 Web 应用必须在嵌入之前发布。如果你更新应用配置，重新发布以在嵌入版本中看到更改。

## 七、自定义样式

你可以使用 CSS 变量或 `containerProps` 选项覆盖默认按钮样式。

### 7.1 修改 CSS 变量

支持的 CSS 变量：

```css
/* Button distance to bottom, default is `1rem` */
--dify-chatbot-bubble-button-bottom

/* Button distance to right, default is `1rem` */
--dify-chatbot-bubble-button-right

/* Button distance to left, default is `unset` */
--dify-chatbot-bubble-button-left

/* Button distance to top, default is `unset` */
--dify-chatbot-bubble-button-top

/* Button background color, default is `#155EEF` */
--dify-chatbot-bubble-button-bg-color

/* Button width, default is `50px` */
--dify-chatbot-bubble-button-width

/* Button height, default is `50px` */
--dify-chatbot-bubble-button-height

/* Button border radius, default is `25px` */
--dify-chatbot-bubble-button-border-radius

/* Button box shadow, default is `rgba(0, 0, 0, 0.2) 0px 4px 8px 0px)` */
--dify-chatbot-bubble-button-box-shadow

/* Button hover transform, default is `scale(1.1)` */
--dify-chatbot-bubble-button-hover-transform
```

示例：将背景颜色更改为 #ABCDEF

```css
#dify-chatbot-bubble-button {
  --dify-chatbot-bubble-button-bg-color: #ABCDEF;
}
```

### 7.2 使用 containerProps

**设置内联样式**：
```javascript
window.difyChatbotConfig = {
  // ... other configurations
  containerProps: {
    style: {
      backgroundColor: '#ABCDEF',
      width: '60px',
      height: '60px',
      borderRadius: '30px',
    },
    // For minor style overrides, you can also use a string value for the `style` attribute:
    // style: 'background-color: #ABCDEF; width: 60px;',
  },
}
```

**应用 CSS 类**：
```javascript
window.difyChatbotConfig = {
  // ... other configurations
  containerProps: {
    className: 'dify-chatbot-bubble-button-custom my-custom-class',
  },
}
```

## 八、传递输入参数

### 8.1 支持的输入类型

有四种类型的输入支持：

1. **text-input**：接受任何值。如果输入字符串的长度超过允许的最大长度，将被截断
2. **paragraph**：类似于 text-input，接受任何值，如果字符串长于最大长度则截断
3. **number**：接受数字或数字字符串。如果提供字符串，将使用 Number 函数转换为数字
4. **options**：接受任何值，前提是它与预配置的选项之一匹配

### 8.2 配置示例

```javascript
window.difyChatbotConfig = {
  // Other configuration settings...
  inputs: {
    name: 'apple',
  },
}
```

**注意**：当使用 embed.js 脚本创建 iframe 时，每个输入值将被处理——使用 GZIP 压缩并使用 base64 编码——然后附加到 URL。

例如，处理后的输入值的 URL 将如下所示：
```
http://localhost/chatbot/{token}?name=H4sIAKUlmWYA%2FwWAIQ0AAACDsl7gLuiv2PQEUNAuqQUAAAA%3D
```

## 九、关键要点

1. **多种嵌入方式**：支持 Chat Bubble、Iframe 和 JavaScript 控制
2. **灵活配置**：可通过 CSS 变量和 JavaScript 配置自定义
3. **响应式设计**：自动适应不同屏幕尺寸
4. **易于集成**：简单的 HTML 或 JavaScript 配置即可完成
5. **统一管理**：所有嵌入使用相同的应用配置

