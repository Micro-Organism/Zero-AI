# MCP 服务器

> 学习来源：https://docs.dify.ai/zh/use-dify/publish/publish-mcp

## 一、概述

Dify 现在支持将你的应用程序作为 **MCP**（Model Context Protocol）服务器公开，实现与 Claude Desktop 等 AI 助手和 Cursor 等开发环境的无缝集成。这使得这些工具可以直接与你的 Dify 应用程序交互，就像它们是原生扩展一样。

**注意**：如果你希望在 Dify 工作流和智能代理中使用 MCP 工具，请参阅 [MCP 工具使用文档](../../构建/mcp.md)。

## 二、将你的 Dify 应用程序配置为 MCP 服务器

### 2.1 配置步骤

1. **导航到配置界面**：在 Dify 中打开应用程序的配置界面
2. **找到 MCP 服务器配置模块**：在配置界面中找到 MCP 服务器配置模块
3. **启用功能**：该功能默认处于禁用状态，需要手动开启
4. **获取服务器地址**：当你开启它时，Dify 会为你的应用程序生成一个唯一的 MCP 服务器地址
5. **使用地址**：该地址作为外部工具的连接点

### 2.2 安全注意事项

**危险警告**：你的 MCP 服务器 URL 包含身份验证凭据，因此请像对待 API 密钥一样对待它。

**安全建议**：
- 如果你怀疑它已被泄露，请使用重新生成按钮创建新的 URL
- 旧的 URL 将立即停止工作
- 不要在前端代码或公开位置暴露此 URL

## 三、与 Claude Desktop 集成

### 3.1 集成步骤

1. **打开 Claude Desktop 设置**：
   - 转到你的 Claude Profile
   - 选择 Settings
   - 选择 Integrations
   - 点击 Add integration

2. **配置集成**：
   - 用你的 Dify 应用程序的服务器 URL 替换集成 URL
   - 保存配置

3. **使用**：配置完成后，Claude Desktop 可以直接与你的 Dify 应用程序交互

## 四、与 Cursor 集成

### 4.1 配置文件设置

对于 Cursor，在你的项目根目录中创建或编辑 `.cursor/mcp.json` 文件：

```json
{
  "mcpServers": {
    "your-server-name": {
      "url": "your-server-url"
    }
  }
}
```

### 4.2 配置说明

- **your-server-name**：为你的服务器指定一个描述性名称
- **your-server-url**：用你的 Dify 应用程序的 MCP 服务器地址替换 URL
- **多应用支持**：你可以通过在 `mcpServers` 对象中添加其他条目来添加多个 Dify 应用程序

### 4.3 自动检测

Cursor 会自动检测此配置并将你的 Dify 应用程序作为工具提供。

## 五、实用注意事项

### 5.1 描述性设计

**重要**：在为你的工具及其输入参数设计描述时，考虑 AI 如何解释它们。

**最佳实践**：
- 使用清晰、具体的描述
- 避免使用"输入数据"这样的通用描述
- 指定具体格式，例如："包含用户配置文件的 JSON 对象，必需字段：姓名、邮箱、偏好设置"

**示例对比**：
- ❌ 不好：`输入数据`
- ✅ 好：`包含用户配置文件的 JSON 对象，必需字段：姓名、邮箱、偏好设置`

### 5.2 延迟考虑

**性能影响**：
- MCP 协议处理通信层，但你的 Dify 应用程序的性能仍然很重要
- 如果你的应用程序通常需要 30 秒来处理，那么这种延迟在客户端应用程序中会被感受到

**优化建议**：
- 考虑添加进度指示器
- 将复杂的工作流分解为更小、更快的操作
- 优化工作流性能以减少响应时间

## 六、使用场景

### 6.1 开发工作流
- 在 Cursor 中直接使用 Dify 应用功能
- 无需切换工具，提高开发效率

### 6.2 AI 助手扩展
- 扩展 Claude Desktop 的功能
- 将 Dify 应用作为 AI 助手的工具

### 6.3 多应用集成
- 在单个开发环境中集成多个 Dify 应用
- 统一管理和使用

## 七、关键要点

1. **安全第一**：MCP 服务器 URL 包含认证信息，需要妥善保管
2. **描述清晰**：工具和参数的描述要具体明确，便于 AI 理解
3. **性能优化**：考虑响应时间，必要时分解复杂操作
4. **多平台支持**：支持 Claude Desktop 和 Cursor 等主流工具
5. **易于集成**：通过简单的配置文件即可完成集成

